<!DOCTYPE html>
<html lang="tr">
<head>
  <base href="/">
  <meta charset="UTF-8">
  <meta content="IE=Edge" http-equiv="X-UA-Compatible">
  <meta name="description" content="Kayseri Millet Bah√ßesi ƒ∞nteraktif Harita Uygulamasƒ±">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- iOS meta tags & icons -->
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta name="apple-mobile-web-app-title" content="Kayseri Millet Bah√ßesi">
  <link rel="apple-touch-icon" href="icons/Icon-192.png">

  <!-- Favicon -->
  <link rel="icon" type="image/png" href="favicon.png"/>

  <title>Kayseri Millet Bah√ßesi</title>
  <link rel="manifest" href="manifest.json">

  <!-- Google Maps JavaScript API -->
  <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDWVBfYxASYj1aTqcS8pvHa67IDic4wthk&libraries=geometry,places"></script>
  
  <!-- Error handling and debug -->
  <script>
    window.addEventListener('error', function(e) {
      console.error('Global error:', e.error);
      const loading = document.getElementById('loading');
      if (loading && !document.getElementById('flutter-view')) {
        loading.innerHTML = `
          <h2>‚ö†Ô∏è Y√ºkleme Sorunu</h2>
          <p>Uygulama y√ºklenirken bir hata olu≈ütu.</p>
          <p><small>Hata: ${e.error?.message || 'Bilinmeyen hata'}</small></p>
          <button onclick="location.reload()">Sayfayƒ± Yenile</button>
        `;
      }
    });
    
    // Flutter y√ºkleme durumunu takip et
    let flutterLoadTimeout;
    
    window.addEventListener('load', function() {
      flutterLoadTimeout = setTimeout(function() {
        const loading = document.getElementById('loading');
        if (loading && !document.getElementById('flutter-view')) {
          loading.innerHTML = `
            <h2>‚è±Ô∏è Y√ºkleme Zaman A≈üƒ±mƒ±</h2>
            <p>Uygulama y√ºklenmesi uzun s√ºr√ºyor.</p>
            <button onclick="location.reload()">Sayfayƒ± Yenile</button>
          `;
        }
      }, 30000); // 30 saniye timeout
    });
    
    // Flutter ba≈üarƒ±yla y√ºklendiƒüinde timeout'u temizle
    window.flutterLoadSuccess = function() {
      if (flutterLoadTimeout) {
        clearTimeout(flutterLoadTimeout);
      }
      const loading = document.getElementById('loading');
      if (loading) {
        loading.style.display = 'none';
      }
    };
  </script>
</head>
<body>
  <!-- Loading indicator -->
  <div id="loading" style="
    position: fixed; 
    top: 0; left: 0; right: 0; bottom: 0;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    color: white;
    text-align: center;
    z-index: 9999;
  ">
    <div style="
      background: rgba(255,255,255,0.1);
      backdrop-filter: blur(10px);
      border-radius: 20px;
      padding: 40px;
      max-width: 400px;
      width: 90%;
    ">
      <div style="font-size: 60px; margin-bottom: 20px;">üó∫Ô∏è</div>
      <h1 style="margin: 0 0 10px 0; font-size: 24px; font-weight: 600;">Kayseri Millet Bah√ßesi</h1>
      <p style="margin: 0 0 30px 0; opacity: 0.8; font-size: 16px;">ƒ∞nteraktif Harita Uygulamasƒ±</p>
      
      <!-- Loading spinner -->
      <div style="
        width: 50px;
        height: 50px;
        border: 4px solid rgba(255,255,255,0.3);
        border-top: 4px solid white;
        border-radius: 50%;
        animation: spin 1s linear infinite;
        margin: 0 auto 20px;
      "></div>
      
      <p style="margin: 0; font-size: 14px; opacity: 0.7;">Y√ºkleniyor...</p>
    </div>
  </div>
  
  <style>
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    body {
      margin: 0;
      padding: 0;
      height: 100vh;
      overflow: hidden;
    }
  </style>

  <!-- Flutter Web Engine -->
  <script>
    console.log('üöÄ Starting Flutter Web App...');
    console.log('Base URL:', document.baseURI);
    console.log('Location:', window.location.href);
    
    // Check if required files exist
    const requiredFiles = [
      'flutter_bootstrap.js',
      'main.dart.js',
      'flutter.js'
    ];
    
    let filesChecked = 0;
    let filesAvailable = 0;
    
    requiredFiles.forEach(file => {
      fetch(file, { method: 'HEAD' })
        .then(response => {
          filesChecked++;
          if (response.ok) {
            filesAvailable++;
            console.log('‚úÖ', file, 'available');
          } else {
            console.error('‚ùå', file, 'not found');
          }
          
          if (filesChecked === requiredFiles.length) {
            console.log(`üìä ${filesAvailable}/${requiredFiles.length} files available`);
            
            if (filesAvailable === requiredFiles.length) {
              loadFlutter();
            } else {
              showError('Gerekli dosyalar bulunamadƒ±');
            }
          }
        })
        .catch(error => {
          filesChecked++;
          console.error('‚ùå Error checking', file, ':', error);
          
          if (filesChecked === requiredFiles.length) {
            // Try to load anyway
            loadFlutter();
          }
        });
    });
    
    function loadFlutter() {
      console.log('üì± Loading Flutter...');
      
      const script = document.createElement('script');
      script.src = 'flutter_bootstrap.js';
      script.type = 'application/javascript';
      
      script.onload = function() {
        console.log('‚úÖ Flutter bootstrap loaded');
        // Flutter y√ºkleme ba≈üarƒ±lƒ± olarak i≈üaretle
        if (typeof window.flutterLoadSuccess === 'function') {
          setTimeout(window.flutterLoadSuccess, 2000);
        }
      };
      
      script.onerror = function(error) {
        console.error('‚ùå Flutter bootstrap failed:', error);
        showError('Flutter y√ºkleme hatasƒ±');
      };
      
      document.head.appendChild(script);
    }
    
    function showError(message) {
      const loading = document.getElementById('loading');
      if (loading) {
        loading.innerHTML = `
          <div style="
            background: rgba(255,255,255,0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 40px;
            max-width: 400px;
            width: 90%;
            text-align: center;
          ">
            <div style="font-size: 60px; margin-bottom: 20px;">‚ùå</div>
            <h1 style="margin: 0 0 10px 0; font-size: 24px; font-weight: 600;">Y√ºkleme Hatasƒ±</h1>
            <p style="margin: 0 0 20px 0; opacity: 0.8;">${message}</p>
            <button onclick="location.reload()" style="
              background: white;
              color: #667eea;
              border: none;
              padding: 12px 24px;
              border-radius: 8px;
              font-size: 16px;
              font-weight: 600;
              cursor: pointer;
            ">Sayfayƒ± Yenile</button>
          </div>
        `;
      }
    }
  </script>
</body>
</html>